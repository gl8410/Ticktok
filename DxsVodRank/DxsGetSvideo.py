import csv
import time
from urllib.parse import urlencode
import requests
from lxml import etree
from selenium import webdriver
import random

VodRank_baseUrl = "https://www.daxiansuo.com/client/web/market/vodrankvideo?"
VodRank_AnchorUrl = "https://www.daxiansuo.com/client/web/market/vodrankdetailpage?"
# 在这里改存储路径
VodRank_storePath="./DxsVodRank/"
# 在这里改文件名
TaskName="0822_1"
# 在这里改cookie
VodRand_Cookie="Hm_lvt_f434dd2d0c8ecc66d832210642e3fa64=1597912234,1598071633,1598084116,1598143748; PHPFRONTSESSID=7fbl3a2gvqed06s2h4qjvljb45; _csrf=992a848fe2977443f932183723bc85031ae9fc813ec78a59786cf2b52a6a0f51a%3A2%3A%7Bi%3A0%3Bs%3A5%3A%22_csrf%22%3Bi%3A1%3Bs%3A32%3A%22J8TKj550JpkWe4J0gKNaxAKFA4Y7ikwV%22%3B%7D; Hm_lpvt_f434dd2d0c8ecc66d832210642e3fa64=1598143810"
VodRank_Header=["VodTitle","VodLong","pub_date","CoverLink","VodLink","TicktockUID","TicktockVID",
                "Likes","Comments","vType","Anchor","Sex","HeadLink","TicktockID","Region","aType","Briefing",
                "TotalFans","TotalLikes","AverageComment","AverageShare","Works"]
VodRank_Header2=["VodTitle","VodLong","pub_time","CoverLink","VodLink","TicktockVID","Anchor","TicktockUID",
                 "Likes","Comments","ChangeRate","UpdateDate"]

VodRank_headers = {
    "Host": "www.daxiansuo.com",
    "Referer": "https://www.daxiansuo.com/client/web/market/vodrank",
    "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.61 Safari/537.36",
    "X-Requested-With": "XMLHttpRequest",
    "Cookie": VodRand_Cookie
}
Anchor_headers={
    "Cookie": "login=f; warning=0; Hm_lvt_f434dd2d0c8ecc66d832210642e3fa64=1597972308,1598087815; PHPFRONTSESSID=0qsr8asdth39qltdqr3hl76fq7; _csrf=f770433c8ffef38f18fe4ee23c69f10205bdaad345d9f793bb1fc2d21abc3a07a%3A2%3A%7Bi%3A0%3Bs%3A5%3A%22_csrf%22%3Bi%3A1%3Bs%3A32%3A%22-0i13CFWyjLQVyijh3ATWSKSRVhN8z-1%22%3B%7D; Hm_lpvt_f434dd2d0c8ecc66d832210642e3fa64=1598088185",
    "Host": "www.daxiansuo.com",
    "Origin": "https://www.daxiansuo.com",
    "Referer": "https://www.daxiansuo.com/client/web/market/vodrankdetailpage?id=59358580310&vid=6860438431315528973",
    "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.61 Safari/537.36",
    "X-Requested-With": "XMLHttpRequest"
}

VodRank_get_params={
    "category": "1",
    "day": "2020-7-23",
    "month": "",
    "startDate": "",
    "endDate": "",
    "dateType": "day",
    "sAge": "",
    "eAge": "",
    "gender": "",
    "province": "",
    "city": "",
    "sTime": "",
    "eTime": "",
    "sLiked": "",
    "eLiked": "",
    "isProduct": "",
    "page": "",
    "limit": "10",
    "orderType": "desc",
    "orderField": "liked"
}

Test_data=[{'VodTitle': '卑微小方块 在线求安慰#当女生被说脸胖时的反应', 'VodLong': '17', 'pub_time': '1595320554', 'CoverLink': 'https://p9-dy.byteimg.com/img/tos-cn-p-0015/e5711795d4284ba8bee1e43863effbeb_1595320557~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6851849590396701952/?region=CN&mid=', 'TicktockVID': '6851849590396701952', 'Anchor': '刘思瑶nice', 'TicktockUID': '60685235913', 'Likes': 2677, 'Comments': 367, 'ChangeRate': '13.71%'}, {'VodTitle': '写出来能叫心里话吗', 'VodLong': '12', 'pub_time': '1590758108', 'CoverLink': 'https://p3-dy-ipv6.byteimg.com/img/tos-cn-p-0015/5f90e5be0782451f915528538213d6d2_1590758112~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6832254040320068872/?region=CN&mid=', 'TicktockVID': '6832254040320068872', 'Anchor': '梅尼耶', 'TicktockUID': '72940146352', 'Likes': 2680, 'Comments': 31, 'ChangeRate': '1.16%'}, {'VodTitle': '男 22岁 未婚', 'VodLong': '6', 'pub_time': '1586606852', 'CoverLink': 'https://p3-dy.byteimg.com/img/tos-cn-p-0015/7134cee148434fd9adf1ad3fd13e454a~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6814424530275093767/?region=CN&mid=', 'TicktockVID': '6814424530275093767', 'Anchor': '梅尼耶', 'TicktockUID': '72940146352', 'Likes': 2709, 'Comments': 32, 'ChangeRate': '1.18%'}, {'VodTitle': '我爱看美女！@孙如云Emilie @屠芷莹 @姜贞羽 #散装rap', 'VodLong': '11', 'pub_time': '1593860666', 'CoverLink': 'https://p26-dy.byteimg.com/img/tos-cn-p-0015/f7673dc200044221b0ac56ad4af73b9c~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6845579422871850255/?region=CN&mid=', 'TicktockVID': '6845579422871850255', 'Anchor': '爆胎草莓粥-张馨文', 'TicktockUID': '58910726039', 'Likes': 2714, 'Comments': 9, 'ChangeRate': '0.33%'}, {'VodTitle': '#假期的四种状态 试喝薯片水果汁，在边缘疯狂试探 @抖音小助手', 'VodLong': '157', 'pub_time': '1580991015', 'CoverLink': 'https://p9-dy.byteimg.com/img/tos-cn-p-0015/d3666322a6db44aca4ec530cd5cfe427~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6790304434426547463/?region=CN&mid=', 'TicktockVID': '6790304434426547463', 'Anchor': 'Leon陈', 'TicktockUID': '93136367456', 'Likes': 2716, 'Comments': 102, 'ChangeRate': '3.76%'}, {'VodTitle': '沙雕的快乐第二弹 #沙雕 #闺蜜 #游戏', 'VodLong': '8', 'pub_time': '1595306675', 'CoverLink': 'https://p3-dy.byteimg.com/img/tos-cn-p-0015/0913a1aaea6c4aa1a5dc93ad6a42ea53~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6851789950497688844/?region=CN&mid=', 'TicktockVID': '6851789950497688844', 'Anchor': '馒头', 'TicktockUID': '92310830405', 'Likes': 2719, 'Comments': 78, 'ChangeRate': '2.87%'}, {'VodTitle': '#王一博 ：什么我的裤子奇奇怪怪，你们不懂啦！哈哈哈哈哈哈哈', 'VodLong': '15', 'pub_time': '1594725984', 'CoverLink': 'https://p9-dy.byteimg.com/img/tos-cn-p-0015/dd45c0a7ce9f44c680b40a4e9edda80d~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6849295934791093518/?region=CN&mid=', 'TicktockVID': '6849295934791093518', 'Anchor': '星娱乐Online', 'TicktockUID': '111442789546', 'Likes': 2724, 'Comments': 91, 'ChangeRate': '3.34%'}, {'VodTitle': '远赴人间  踏遍山河去寻你 唯有你让我觉得 山河滚烫 星海荡漾  人间值得#丽江', 'VodLong': '9', 'pub_time': '1595737966', 'CoverLink': 'https://p9-dy-ipv6.byteimg.com/img/tos-cn-p-0015/b68be7ec43144a61aae0a675a2047283~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6853642363508772110/?region=CN&mid=', 'TicktockVID': '6853642363508772110', 'Anchor': '小嚯行游(旅拍自由行接待）', 'TicktockUID': '60608403052', 'Likes': 2734, 'Comments': 178, 'ChangeRate': '6.51%'}, {'VodTitle': '别害怕，你的男人是神！', 'VodLong': '49', 'pub_time': '1591279383', 'CoverLink': 'https://p3-dy.byteimg.com/img/tos-cn-p-0015/5ecff3262aca4a42882d53f7fea2a6e5~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6834468406452931840/?region=CN&mid=', 'TicktockVID': '6834468406452931840', 'Anchor': '绿茶影视', 'TicktockUID': '59103455179', 'Likes': 2735, 'Comments': 68, 'ChangeRate': '2.49%'}, {'VodTitle': '南方人在东北是如何被饿si的??', 'VodLong': '24', 'pub_time': '1589773844', 'CoverLink': 'https://p3-dy-ipv6.byteimg.com/img/tos-cn-p-0015/8c4a5af65aac493dabad16d41b1e88fc~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6828026634608725251/?region=CN&mid=', 'TicktockVID': '6828026634608725251', 'Anchor': '丸子联萌', 'TicktockUID': '95612352172', 'Likes': 2750, 'Comments': 136, 'ChangeRate': '4.95%'}, {'VodTitle': '我连队友都带不动,还指望我带货?!?', 'VodLong': '31', 'pub_time': '1594623948', 'CoverLink': 'https://p6-dy-ipv6.byteimg.com/img/tos-cn-p-0015/4b82857105d34272bfd6f380a5afbf42_1594623951~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6848857651812601091/?region=CN&mid=', 'TicktockVID': '6848857651812601091', 'Anchor': '张大仙', 'TicktockUID': '62427282029', 'Likes': 2781, 'Comments': 27, 'ChangeRate': '0.97%'}, {'VodTitle': '？？？', 'VodLong': '10', 'pub_time': '1593255497', 'CoverLink': 'https://p9-dy.byteimg.com/img/tos-cn-p-0015/f0436d531ea941098da4f6a60d302fac~c5_300x400.webp?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6842980216629972231/?region=CN&mid=', 'TicktockVID': '6842980216629972231', 'Anchor': '赵露思', 'TicktockUID': '58606884048', 'Likes': 2786, 'Comments': 23, 'ChangeRate': '0.83%'}, {'VodTitle': '一切都有最好的安排！幸亏我当初发誓说的是嫁到他们家@叶公子的日常  #小晶钻reno4', 'VodLong': '82', 'pub_time': '1591435800', 'CoverLink': 'https://p3-dy-ipv6.byteimg.com/img/tos-cn-p-0015/40891419476c47d69a8ccaa18019140c~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6835112060704017679/?region=CN&mid=', 'TicktockVID': '6835112060704017679', 'Anchor': '叶公子', 'TicktockUID': '110541851171', 'Likes': 2793, 'Comments': 74, 'ChangeRate': '2.65%'}, {'VodTitle': '#伤感 #精神小伙   这波够伤感吗？？哭没 #悲伤的艺术', 'VodLong': '18', 'pub_time': '1577883130', 'CoverLink': 'https://p9-dy.byteimg.com/img/tos-cn-p-0015/bc2e9cfc85924949bb7a5a89570bd7a0~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6776956418642791695/?region=CN&mid=', 'TicktockVID': '6776956418642791695', 'Anchor': '王摇摆', 'TicktockUID': '57829917429', 'Likes': 2806, 'Comments': 37, 'ChangeRate': '1.32%'}, {'VodTitle': '你们要的不心动挑战来了 #挑战  #不心动挑战  #变装', 'VodLong': '48', 'pub_time': '1593339630', 'CoverLink': 'https://p9-dy.byteimg.com/img/tos-cn-p-0015/2fabc736fc3d4113a571818a590845e7~c5_300x400.webp?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6843341516157504775/?region=CN&mid=', 'TicktockVID': '6843341516157504775', 'Anchor': '你李总啊', 'TicktockUID': '101439273672', 'Likes': 2812, 'Comments': 52, 'ChangeRate': '1.85%'}, {'VodTitle': '你们都是怎么生活的呢？是像他@豆爹与豆妈 还是像我呢？', 'VodLong': '20', 'pub_time': '1593835265', 'CoverLink': 'https://p9-dy.byteimg.com/img/tos-cn-p-0015/0aeba4f6174147e48e6054e612346c93_1593835268~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6845470323752652047/?region=CN&mid=', 'TicktockVID': '6845470323752652047', 'Anchor': '花式游侠', 'TicktockUID': '104744995883', 'Likes': 2824, 'Comments': 24, 'ChangeRate': '0.85%'}, {'VodTitle': '“有些人，一旦错过就不再”#百万赞演技大赏  #情绪大师  @丁七七', 'VodLong': '91', 'pub_time': '1594120804', 'CoverLink': 'https://p3-dy.byteimg.com/img/tos-cn-p-0015/759a4f078f7e46b082624bcaea011f5c~tplv-dmt-logoccm:300:400:tos-cn-i-0813/2866ccee42514c6f89c199f6ccfc641a.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6846696626887625992/?region=CN&mid=', 'TicktockVID': '6846696626887625992', 'Anchor': '情绪唱片', 'TicktockUID': '110181729869', 'Likes': 2845, 'Comments': 62, 'ChangeRate': '2.18%'}, {'VodTitle': '这是一起路怒症引起的车祸，如果你是交警，你会怎么判 ？?', 'VodLong': '40', 'pub_time': '1595562914', 'CoverLink': 'https://p6-dy-ipv6.byteimg.com/img/tos-cn-p-0015/69fa05bb357e4d17b7349a0af31a78ab_1595562918~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6852890497774570755/?region=CN&mid=', 'TicktockVID': '6852890497774570755', 'Anchor': '人民信产', 'TicktockUID': '2809967227699934', 'Likes': 2870, 'Comments': 675, 'ChangeRate': '23.52%'}, {'VodTitle': '你有好男朋友算什么，我有好婆婆…#我怎么这么爱秀', 'VodLong': '171', 'pub_time': '1590742705', 'CoverLink': 'https://p3-dy.byteimg.com/img/tos-cn-p-0015/d46d83fa6220401c9cfbd9f3f4947cd8~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6832096698668436748/?region=CN&mid=', 'TicktockVID': '6832096698668436748', 'Anchor': '幻颜当铺', 'TicktockUID': '461439118344732', 'Likes': 2871, 'Comments': 158, 'ChangeRate': '5.50%'}, {'VodTitle': '#药水哥 万恶之源来了，喜欢黄头发的兄弟萌，把喜欢打在公屏上', 'VodLong': '54', 'pub_time': '1557201651', 'CoverLink': 'https://p3-dy.byteimg.com/aweme/300x400/17a550018597cf3146e5c.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6688124062943776014/?region=CN&mid=', 'TicktockVID': '6688124062943776014', 'Anchor': '药水哥', 'TicktockUID': '109769200179', 'Likes': 2871, 'Comments': 2, 'ChangeRate': '0.07%'}, {'VodTitle': '续集来了，结婚后婆媳关系又是一本难念的经#机智编歌 #百变小飞 @编歌福星直播 改编', 'VodLong': '102', 'pub_time': '1595226326', 'CoverLink': 'https://p26-dy.byteimg.com/img/tos-cn-p-0015/1afe49f67e2c4f0ea3de66ea4a16a9fb_1595226358~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6851444880711879949/?region=CN&mid=', 'TicktockVID': '6851444880711879949', 'Anchor': '百变小飞(机智歌王', 'TicktockUID': '95753531938', 'Likes': 5430, 'Comments': 127, 'ChangeRate': '2.34%'}, {'VodTitle': '“上班穿成这样，老板应该不会介意吧”#绿茶拍照', 'VodLong': '11', 'pub_time': '1594123041', 'CoverLink': 'https://p6-dy-ipv6.byteimg.com/img/tos-cn-p-0015/f01f4b39d36e4b47bdb12ac73c763c49~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6846706290929011972/?region=CN&mid=', 'TicktockVID': '6846706290929011972', 'Anchor': '丝丝', 'TicktockUID': '63215434953', 'Likes': 5472, 'Comments': 137, 'ChangeRate': '2.50%'}, {'VodTitle': '确认过了是一毛不拔的#弟弟 ?#抖音小助手', 'VodLong': '59', 'pub_time': '1588735886', 'CoverLink': 'https://p3-dy-ipv6.byteimg.com/img/tos-cn-p-0015/e029d32292984d869587b05c64ccaf82_1588735897~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6823568640747506947/?region=CN&mid=', 'TicktockVID': '6823568640747506947', 'Anchor': '小汪同志 22号中午12点零食混播', 'TicktockUID': '67560374516', 'Likes': 5563, 'Comments': 405, 'ChangeRate': '7.28%'}, {'VodTitle': '被低估十年，如今仍是经典～武侠悬疑《剑雨》！#宅家dou剧场', 'VodLong': '223', 'pub_time': '1590208561', 'CoverLink': 'https://p3-dy.byteimg.com/img/tos-cn-p-0015/723314d663a94f61a81169a549f6f3c9~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6829893545030159627/?region=CN&mid=', 'TicktockVID': '6829893545030159627', 'Anchor': '婧公子', 'TicktockUID': '82996488038', 'Likes': 5574, 'Comments': 61, 'ChangeRate': '1.09%'}, {'VodTitle': '问问你的闺蜜/兄弟 "货"准备好了吗#兄弟 #闺蜜 #这个视频有点料', 'VodLong': '58', 'pub_time': '1592906344', 'CoverLink': 'https://p6-dy-ipv6.byteimg.com/img/tos-cn-p-0015/937994b42f1f4862be1e38171dccc06e_1592906350~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6841480570644565256/?region=CN&mid=', 'TicktockVID': '6841480570644565256', 'Anchor': '佟悦佟悦?', 'TicktockUID': '68664425904', 'Likes': 5644, 'Comments': 198, 'ChangeRate': '3.51%'}, {'VodTitle': '危险又迷人', 'VodLong': '10', 'pub_time': '1594117328', 'CoverLink': 'https://p3-dy.byteimg.com/img/tos-cn-p-0015/6e338687411b4c159336611f11712870~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6846681775943552263/?region=CN&mid=', 'TicktockVID': '6846681775943552263', 'Anchor': '天才小火龙', 'TicktockUID': '64053096019', 'Likes': 5690, 'Comments': 191, 'ChangeRate': '3.36%'}, {'VodTitle': '你品你细品#抖音小助手 #街头采访', 'VodLong': '28', 'pub_time': '1593741454', 'CoverLink': 'https://p9-dy.byteimg.com/img/tos-cn-p-0015/85dae51ae8254609b1d02d34fbdb3c1a~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6845067405379505422/?region=CN&mid=', 'TicktockVID': '6845067405379505422', 'Anchor': '李大漂亮.', 'TicktockUID': '79994665809', 'Likes': 5748, 'Comments': 148, 'ChangeRate': '2.57%'}, {'VodTitle': '男生vs女生', 'VodLong': '15', 'pub_time': '1593945532', 'CoverLink': 'https://p29-dy.byteimg.com/img/tos-cn-p-0015/540a2f7e51a647bcabe9aa3e6b08eb84~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6845943917226020096/?region=CN&mid=', 'TicktockVID': '6845943917226020096', 'Anchor': '贾斯丁.', 'TicktockUID': '57438500549', 'Likes': 5769, 'Comments': 203, 'ChangeRate': '3.52%'}, {'VodTitle': '别害怕，你的男人是神！', 'VodLong': '49', 'pub_time': '1591279383', 'CoverLink': 'https://p3-dy.byteimg.com/img/tos-cn-p-0015/5ecff3262aca4a42882d53f7fea2a6e5~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6834468406452931840/?region=CN&mid=', 'TicktockVID': '6834468406452931840', 'Anchor': '绿茶影视', 'TicktockUID': '59103455179', 'Likes': 5780, 'Comments': 146, 'ChangeRate': '2.53%'}, {'VodTitle': '翻身温温把歌唱 #惹毛妈妈的一百种方式', 'VodLong': '144', 'pub_time': '1580728577', 'CoverLink': 'https://p3-dy.byteimg.com/img/tos-cn-p-0015/803ac7e1187e42d09c5c723d8573ac3d~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6789177391081082124/?region=CN&mid=', 'TicktockVID': '6789177391081082124', 'Anchor': '温精灵', 'TicktockUID': '62595850082', 'Likes': 5817, 'Comments': 426, 'ChangeRate': '7.32%'}, {'VodTitle': '一个人反而更high的星座，是不是你？#星座 #十二星座', 'VodLong': '31', 'pub_time': '1584796979', 'CoverLink': 'https://p9-dy.byteimg.com/img/tos-cn-p-0015/176a634eb4dc4566bcd83b23a8521f49~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6806651189166394631/?region=CN&mid=', 'TicktockVID': '6806651189166394631', 'Anchor': '罗导说星座', 'TicktockUID': '95591948189', 'Likes': 5840, 'Comments': 214, 'ChangeRate': '3.66%'}, {'VodTitle': '有一种生物叫“别人家的” #百万赞演技大赏  @抖音小助手', 'VodLong': '71', 'pub_time': '1595326219', 'CoverLink': 'https://p6-dy-ipv6.byteimg.com/img/tos-cn-p-0015/bb654c537b9f477495b06e69204cf1fb_1595326226~tplv-dmt-logoccm:300:400:tos-cn-i-0813/730aa1710d02475eaedd556f5f28bcd9.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6851873641613888776/?region=CN&mid=', 'TicktockVID': '6851873641613888776', 'Anchor': '佟悦佟悦?', 'TicktockUID': '68664425904', 'Likes': 5847, 'Comments': 200, 'ChangeRate': '3.42%'}, {'VodTitle': '她很轻易的说出那句话，或许她还不理解爸爸S了是什么概念，听了很心疼 @抖音小助手', 'VodLong': '125', 'pub_time': '1594533476', 'CoverLink': 'https://p9-dy.byteimg.com/img/tos-cn-p-0015/047dcf22f8d44f1d8f7c97b26544952b_1594533511~tplv-dmt-logoccm:300:400:tos-cn-i-0813/cda850164dc7409e83b138af4a619f99.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6848469047349136653/?region=CN&mid=', 'TicktockVID': '6848469047349136653', 'Anchor': '天志', 'TicktockUID': '72103124661', 'Likes': 5850, 'Comments': 206, 'ChangeRate': '3.52%'}, {'VodTitle': '关键时刻的#救命 穴位，为了自己和家人抓紧收藏吧#医学科普', 'VodLong': '24', 'pub_time': '1592562057', 'CoverLink': 'https://p26-dy.byteimg.com/img/tos-cn-p-0015/1abf1f5529ab4d87b29426abcba79a85~c5_300x400.jpeg?from=2563711402_large&l=2020062007310301000805908222A56B65', 'VodLink': 'https://www.iesdouyin.com/share/video/6840001947798375695/?region=CN&mid=', 'TicktockVID': '6840001947798375695', 'Anchor': '静静医生', 'TicktockUID': '96645859651', 'Likes': 5909, 'Comments': 86, 'ChangeRate': '1.46%'}, {'VodTitle': '家人们，早训打卡了，龙教直播间等你！#抖音小助手 #客厅跳起来 #每天坚持锻炼', 'VodLong': '58', 'pub_time': '1594852023', 'CoverLink': 'https://p26-dy.byteimg.com/img/tos-cn-p-0015/d5db3b2da5aa4b699239cc57d9859f7b~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6849837227086728462/?region=CN&mid=', 'TicktockVID': '6849837227086728462', 'Anchor': '龙教健身舞  早6:30 晚7:00直播', 'TicktockUID': '93129114113', 'Likes': 6033, 'Comments': 147, 'ChangeRate': '2.44%'}, {'VodTitle': '浪子之所以成为浪子，是因为有家', 'VodLong': '65', 'pub_time': '1593769434', 'CoverLink': 'https://p6-dy-ipv6.byteimg.com/img/tos-cn-p-0015/0096a3216dcc4082b1e673fe7f72a4a8_1593769471~tplv-dmt-logoccm:300:400:tos-cn-i-0813/28d1436f24a4477094d8dd32e6aa94ca.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6845187511174565127/?region=CN&mid=', 'TicktockVID': '6845187511174565127', 'Anchor': '菲戈', 'TicktockUID': '65803894139', 'Likes': 6044, 'Comments': 109, 'ChangeRate': '1.80%'}, {'VodTitle': '《天上的星星不说话》这首歌也太好哭了吧#我在抖音看综艺', 'VodLong': '125', 'pub_time': '1593924021', 'CoverLink': 'https://p9-dy.byteimg.com/img/tos-cn-p-0015/9e355495d20545daab9545116aa32c25~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6845851454310321415/?region=CN&mid=', 'TicktockVID': '6845851454310321415', 'Anchor': '抖音综艺', 'TicktockUID': '100466457634', 'Likes': 6106, 'Comments': 173, 'ChangeRate': '2.83%'}, {'VodTitle': '很多人问我，一个人带三个孩子，爸爸去上班，我还能出门买菜做饭是怎么样带过来的，今天给大家演示一下#家有萌娃', 'VodLong': '44', 'pub_time': '1594173619', 'CoverLink': 'https://p3-dy.byteimg.com/img/tos-cn-p-0015/dfe529034d864da2944c59a92d1077ee~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6846923507281054979/?region=CN&mid=', 'TicktockVID': '6846923507281054979', 'Anchor': '三胞胎平安福', 'TicktockUID': '74182658813', 'Likes': 6110, 'Comments': 74, 'ChangeRate': '1.21%'}, {'VodTitle': '#秦昊 给米粒唱小白船，米粒：我当时心里害怕极了', 'VodLong': '41', 'pub_time': '1594302283', 'CoverLink': 'https://p9-dy.byteimg.com/img/tos-cn-p-0015/26894bd057864ab2983e93b565e27504_1594302286~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6847476151150005518/?region=CN&mid=', 'TicktockVID': '6847476151150005518', 'Anchor': '湖南娱乐', 'TicktockUID': '96170903569', 'Likes': 6111, 'Comments': 143, 'ChangeRate': '2.34%'}, {'VodTitle': '#解锁人脸运镜术 #治愈笑容', 'VodLong': '12', 'pub_time': '1594248851', 'CoverLink': 'https://p9-dy.byteimg.com/img/tos-cn-p-0015/d8d8c86d81ae43aea095039a656b95ea~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6847246629100211471/?region=CN&mid=', 'TicktockVID': '6847246629100211471', 'Anchor': '甜心_6285', 'TicktockUID': '81663212594', 'Likes': 6287, 'Comments': 98, 'ChangeRate': '1.56%'}, {'VodTitle': '#高速收费员 看到她笑的那一刻，我心疼了！', 'VodLong': '30', 'pub_time': '1578046103', 'CoverLink': 'https://p9-dy.byteimg.com/img/tos-cn-p-0015/d8b36befed4846208dd5721dafec8454_1578046112~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6777656355864972548/?region=CN&mid=', 'TicktockVID': '6777656355864972548', 'Anchor': '浙江交通', 'TicktockUID': '85338072614', 'Likes': 3291, 'Comments': 69, 'ChangeRate': '2.10%'}, {'VodTitle': '普通感冒不用药？加重了找我负责？您可别为难我了！#全民健康计划 @河豚健康', 'VodLong': '86', 'pub_time': '1593766388', 'CoverLink': 'https://p3-dy.byteimg.com/img/tos-cn-p-0015/6edb445900554fe6addafd6df902af85~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6845174409502739719/?region=CN&mid=', 'TicktockVID': '6845174409502739719', 'Anchor': '儿科唐医生', 'TicktockUID': '104922407437', 'Likes': 3300, 'Comments': 224, 'ChangeRate': '6.79%'}, {'VodTitle': '#幸福触手可及 #幸福召唤挑战 ☺️☺️☺️', 'VodLong': '15', 'pub_time': '1591352039', 'CoverLink': 'https://p26-dy.byteimg.com/img/tos-cn-p-0015/1bdd0550c8304701b2b71ed0d83b24c8~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6834804956776664328/?region=CN&mid=', 'TicktockVID': '6834804956776664328', 'Anchor': 'Dear-迪丽热巴', 'TicktockUID': '88445518961', 'Likes': 3328, 'Comments': 519, 'ChangeRate': '15.59%'}, {'VodTitle': '转给你身边，泡脚也这流程的人  #泡脚', 'VodLong': '26', 'pub_time': '1590284921', 'CoverLink': 'https://p9-dy.byteimg.com/img/tos-cn-p-0015/74d725790d784a64a14a34d792369c37~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6830221696155274507/?region=CN&mid=', 'TicktockVID': '6830221696155274507', 'Anchor': '王蓝莓', 'TicktockUID': '59858219214', 'Likes': 3347, 'Comments': 192, 'ChangeRate': '5.74%'}, {'VodTitle': '共患难的女人有多可贵 一起吃面多幸福', 'VodLong': '95', 'pub_time': '1594288743', 'CoverLink': 'https://p6-dy-ipv6.byteimg.com/img/tos-cn-p-0015/ab61166331f448d1a9c30d50bd20d387~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6847417996214881536/?region=CN&mid=', 'TicktockVID': '6847417996214881536', 'Anchor': '房岩小哥', 'TicktockUID': '60965882796', 'Likes': 3375, 'Comments': 86, 'ChangeRate': '2.55%'}, {'VodTitle': '#闺蜜照 献上闺蜜辣妹照！了解一下~@DOU+小助手', 'VodLong': '24', 'pub_time': '1593605088', 'CoverLink': 'https://p3-dy-ipv6.byteimg.com/img/tos-cn-p-0015/980363d3f00e4ae8b06c0298e2a1610d~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6844481695102749952/?region=CN&mid=', 'TicktockVID': '6844481695102749952', 'Anchor': 'Hello胡馨宇', 'TicktockUID': '59360558230', 'Likes': 3376, 'Comments': 160, 'ChangeRate': '4.74%'}, {'VodTitle': '张若宇的vlog第十三期@抖音小助手 @抖音星探家 #张若宇的卑微生活', 'VodLong': '61', 'pub_time': '1593424836', 'CoverLink': 'https://p26-dy.byteimg.com/img/tos-cn-p-0015/c371cf9e6df742508095ecb08b7a4684~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6843707541797604623/?region=CN&mid=', 'TicktockVID': '6843707541797604623', 'Anchor': '张若宇', 'TicktockUID': '58938795803', 'Likes': 3393, 'Comments': 32, 'ChangeRate': '0.94%'}, {'VodTitle': '#传闻中的陈芊芊 韩烁的独家秘笈，会单边挑眉的男生也太撩了吧~#丁禹兮韩烁挑眉杀', 'VodLong': '10', 'pub_time': '1590374027', 'CoverLink': 'https://p9-dy.byteimg.com/img/tos-cn-p-0015/e655fb9f6ae44e2288f2db444759d732_1590374029~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6830604423585189120/?region=CN&mid=', 'TicktockVID': '6830604423585189120', 'Anchor': '传闻中的陈芊芊', 'TicktockUID': '92997557824', 'Likes': 3427, 'Comments': 40, 'ChangeRate': '1.17%'}, {'VodTitle': '阿 么 去 爬 山 #散装rap挑战', 'VodLong': '11', 'pub_time': '1593771256', 'CoverLink': 'https://p9-dy.byteimg.com/img/tos-cn-p-0015/ee05902ba38e40adac274444a403a6c2~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6845195405874056461/?region=CN&mid=', 'TicktockVID': '6845195405874056461', 'Anchor': '奶片锅锅', 'TicktockUID': '108740650605', 'Likes': 3443, 'Comments': 62, 'ChangeRate': '1.80%'}, {'VodTitle': '蓝可儿之旅：“死亡酒店”到底有多恐怖？#电影#抖音电影#解说电影#推荐电影', 'VodLong': '188', 'pub_time': '1593857180', 'CoverLink': 'https://p29-dy.byteimg.com/img/tos-cn-p-0015/9262bda050564e9da54a9a3da30b73c6~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6845564380499774734/?region=CN&mid=', 'TicktockVID': '6845564380499774734', 'Anchor': '風哥电影', 'TicktockUID': '71549957313', 'Likes': 3483, 'Comments': 239, 'ChangeRate': '6.86%'}, {'VodTitle': '来春熙路走走，就知道自己有多土。', 'VodLong': '22', 'pub_time': '1593660418', 'CoverLink': 'https://p6-dy-ipv6.byteimg.com/img/tos-cn-p-0015/89a616ee346340f38513a3aef6d5b244_1593660427~tplv-dmt-logoccm:300:400:tos-cn-i-0813/1fba8acb78fe410b8edf5454a12476af.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6844719185331801347/?region=CN&mid=', 'TicktockVID': '6844719185331801347', 'Anchor': '不懂街拍', 'TicktockUID': '61724686725', 'Likes': 3484, 'Comments': 157, 'ChangeRate': '4.51%'}, {'VodTitle': '妈妈你还忍心抛下我吗？', 'VodLong': '172', 'pub_time': '1593559629', 'CoverLink': 'https://p3-dy.byteimg.com/img/tos-cn-p-0015/05b1e43c4ae74ff4abff7ec7784b5763~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6844286372723821831/?region=CN&mid=', 'TicktockVID': '6844286372723821831', 'Anchor': '戴货团@启梦', 'TicktockUID': '1508137569619356', 'Likes': 3500, 'Comments': 146, 'ChangeRate': '4.17%'}, {'VodTitle': '所以，爱会消失对不对', 'VodLong': '31', 'pub_time': '1591771941', 'CoverLink': 'https://p9-dy.byteimg.com/img/tos-cn-p-0015/a6d3893c5b5c437cb6e66fe1a599d419_1591771952~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6836608137924070659/?region=CN&mid=', 'TicktockVID': '6836608137924070659', 'Anchor': '游鱼YOUYU', 'TicktockUID': '68544617935', 'Likes': 3503, 'Comments': 84, 'ChangeRate': '2.40%'}, {'VodTitle': '这是你没见过的全新版本。', 'VodLong': '10', 'pub_time': '1594892883', 'CoverLink': 'https://p3-dy.byteimg.com/img/tos-cn-p-0015/1a0d3698e50049969756652071b5ba9f~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6850012758600076559/?region=CN&mid=', 'TicktockVID': '6850012758600076559', 'Anchor': '慧慧周', 'TicktockUID': '77330454358', 'Likes': 3509, 'Comments': 115, 'ChangeRate': '3.28%'}, {'VodTitle': '还笑？？阿姨带你们去爬山！', 'VodLong': '12', 'pub_time': '1593346129', 'CoverLink': 'https://p3-dy.byteimg.com/img/tos-cn-p-0015/558b20affe23472c955212170fbd189b_1593346131~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6843369503670291720/?region=CN&mid=', 'TicktockVID': '6843369503670291720', 'Anchor': '柯豆和小虫草', 'TicktockUID': '71600958198', 'Likes': 3519, 'Comments': 314, 'ChangeRate': '8.92%'}, {'VodTitle': '？？？？？', 'VodLong': '24', 'pub_time': '1593734400', 'CoverLink': 'https://p6-dy-ipv6.byteimg.com/img/tos-cn-p-0015/41bc70775c644b338debf51b1b493f47_1593690419~tplv-dmt-logoccm:300:400:tos-cn-i-0813/fa4a129ef5a640ba891b427225d0b946.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6844848114507992334/?region=CN&mid=', 'TicktockVID': '6844848114507992334', 'Anchor': '陶阿狗君', 'TicktockUID': '62828181994', 'Likes': 3529, 'Comments': 74, 'ChangeRate': '2.10%'}, {'VodTitle': '有孩子的赶紧去试试，还没孩子的可以保存到本地转发给身边有孩子的家人朋友们。', 'VodLong': '30', 'pub_time': '1594558507', 'CoverLink': 'https://p29-dy.byteimg.com/img/tos-cn-p-0015/c5b5b95f83ab4ec38525c5838147fb0b_1594558515~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6848576628029771016/?region=CN&mid=', 'TicktockVID': '6848576628029771016', 'Anchor': '老爸评测', 'TicktockUID': '93389153804', 'Likes': 3548, 'Comments': 181, 'ChangeRate': '5.10%'}, {'VodTitle': '最火的iPhone壁纸你还不赶快换上？@老樊不想拍照 素材传送门！#iphone #壁纸', 'VodLong': '14', 'pub_time': '1595241011', 'CoverLink': 'https://p3-dy.byteimg.com/img/tos-cn-p-0015/4caea06a680a4a09a77ab529b7f65017~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6851507925182057739/?region=CN&mid=', 'TicktockVID': '6851507925182057739', 'Anchor': '绅士黑科技', 'TicktockUID': '1552150044881483', 'Likes': 3554, 'Comments': 87, 'ChangeRate': '2.45%'}, {'VodTitle': '世界上最怂的羊，稍微受到刺激就会晕倒，如果要抓它的话只需要吓唬它一下#动物 #涨知识 #dou出新知', 'VodLong': '30', 'pub_time': '1592817909', 'CoverLink': 'https://p3-dy.byteimg.com/img/tos-cn-p-0015/3f888615cea24a4da45f80188c5c92e2_1592817913~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6841100820080053504/?region=CN&mid=', 'TicktockVID': '6841100820080053504', 'Anchor': '黑科技密码', 'TicktockUID': '646103832476395', 'Likes': 3576, 'Comments': 145, 'ChangeRate': '4.05%'}, {'VodTitle': '十五秒教会你制作儿童节专属视频#手机摄影 #剪出春日好心情 @剪映研究所', 'VodLong': '52', 'pub_time': '1590833882', 'CoverLink': 'https://p9-dy.byteimg.com/img/tos-cn-p-0000/485150b532d04b81b4e1215e052ab019~c5_300x400.jpeg?from=2563711402_large', 'VodLink': 'https://www.iesdouyin.com/share/video/6832579241649949966/?region=CN&mid=', 'TicktockVID': '6832579241649949966', 'Anchor': '达芬奇学长', 'TicktockUID': '63175697355', 'Likes': 3689, 'Comments': 98, 'ChangeRate': '2.66%'}]

def getJson(baseurl="",params={},headers={}):
    url=baseurl+urlencode(params)
    try:
        req=requests.get(url,headers=headers)
        if req.status_code==200:
            req.encoding="utf-8"
            return req.json()
    except requests.ConnectionError as e:
        print("Connection error",e.args)

def getRow(json):
    if json:
        items=json.get("data").get("list")
        for item in items:
            vod= {}
            vod["VodTitle"]=str(item.get("vintro"))
            vod["VodLong"]=item.get("vlong")
            timeSec=int(item.get("pub_dt"))
            timeDate=time.strftime('%Y-%m-%d %H:%M:%S',time.localtime(timeSec))
            vod["pub_time"]=str(timeDate)
            vod["CoverLink"]=str(item.get("cover"))
            vod["VodLink"]=str(item.get("dyvid2"))
            vod["TicktockVID"] = item.get("dyvid")
            vod["Anchor"]=str(item.get("nickname"))
            vod["TicktockUID"]= item.get("dyuid")
            vod["Likes"]=item.get("liked")
            vod["Comments"]=item.get("comments")
            vod["ChangeRate"]=item.get("lc")
            yield vod

def getAnchor(id,vid):
    url=VodRank_AnchorUrl+"id="+str(id)+"&"+"vid="+str(vid)
    anchorInfo=[]
    try:
        br=webdriver.Edge(executable_path="../../Selenium/msedgedriver.exe")
        time.sleep(25)
        br.get(url)
        time.sleep(3)
        req = br.page_source
        if req != "":
            #req.encoding="utf-8"
            html=etree.HTML(req)
            #name
            anchorInfo.insert(0,html.xpath('//div[@class="fl changGuiJieShao"]/p/text()'))
            #TicktockID
            anchorInfo.insert(1,html.xpath('//div[@class="fl changGuiJieShao"]/table/tbody/tr[1]/td'))
            #Sex
            anchorInfo.insert(2,html.xpath('//div[@class="fl changGuiJieShao"]/table/tbody/tr[2]/td[1]'))
            #Region
            anchorInfo.insert(3,html.xpath('//div[@class="fl changGuiJieShao"]/table/tbody/tr[2]/td[2]'))
            #aType
            anchorInfo.insert(4,html.xpath('//div[@class="fl changGuiJieShao"]/table/tbody/tr[3]/td[1]'))
            #Briefing
            anchorInfo.insert(5,html.xpath('//div[@class="jianJie1001"]/p/text()'))
            #TotalFans
            anchorInfo.insert(6,html.xpath('//div[@class="fl leftItem2"]/div[1]/table/tbody/tr[2]/td[1]'))
            #"TotalLikes"
            anchorInfo.insert(7,html.xpath('//div[@class="fl leftItem2"]/div[2]/table/tbody/tr[2]/td[1]'))
            #"AverageComment"
            anchorInfo.insert(8,html.xpath('//div[@class="fl leftItem2"]/div[3]/table/tbody/tr[2]/td[1]'))
            #"AverageShare"
            anchorInfo.insert(9,html.xpath('//div[@class="fl leftItem2"]/div[3]/table/tbody/tr[2]/td[2]'))
            #"Works"
            anchorInfo.insert(9, html.xpath('//div[@class="fl leftItem2"]/div[1]/table/tbody/tr[2]/td[2]'))
    except requests.ConnectionError as e:
        print("Connection error",e.args)
    return anchorInfo



def makeCsv(Test_data):
    name=VodRank_storePath+TaskName+".csv"
    with open(name, mode="w", encoding="utf-8", newline="") as f:
        f_csv = csv.writer(f)
        f_csv.writerow(VodRank_Header2)
        for r in Test_data:
            f_csv.writerow(r.values())

def getJsonbySetting():
    m=8
    i=0
    data=[]
    for d in range(21,23):
        VodRank_get_params["day"]="2020"+"-"+str(m)+"-"+str(d)
        for p in range(28,31):
            s=random.random()*5
            time.sleep(s)
            VodRank_get_params["page"]=str(p)
            json=getJson(VodRank_baseUrl, VodRank_get_params,VodRank_headers)
            rows=getRow(json)
            for r in rows:
                r["UpdateDate"]=VodRank_get_params["day"]
                data.insert(0,r)
                print("正在下载第 "+str(i)+" 行数据!"+"\n")
                i=i+1
    print("下载完成，准备写入")
    makeCsv(data)

if __name__=="__main__":
    getJsonbySetting()